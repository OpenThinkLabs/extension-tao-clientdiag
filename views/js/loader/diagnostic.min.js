!function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),
"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function(bundles){bundles=(bundles=(bundles=bundles||[]).concat(window.bundles)).filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})}(),define("loader/bootstrap",function(){}),define("taoClientDiagnostic/tools/fixedDecimals",[],function(){"use strict";return function(
value,decimals){var shift=Math.pow(10,Math.abs(decimals||1));return Math.round(Number(value)*shift)/shift||0}}),define("taoClientDiagnostic/tools/stats",["lodash","taoClientDiagnostic/tools/fixedDecimals"],function(_,fixedDecimals){"use strict";return function(list,fieldName,decimals){var variance,avg,med,middle,getValue,results,sum=0,sum2=0,min=Number.MAX_VALUE,max=0,count=0,values=[];return getValue=_.isFunction(fieldName)?fieldName:function(item){return item&&item[fieldName]||0},_.forEach(list,function(item){var value;void 0!==item&&(value=getValue(item),values.push(value),min=Math.min(min,value),max=Math.max(max,value),sum+=value,count++)}),avg=sum/(
count||1),_.forEach(values,function(value){var diff=value-avg;sum2+=diff*diff}),variance=1<count?Math.sqrt(sum2/(count-1)):0,values.sort(),middle=count/2,med=(values[Math.floor(middle)]+values[Math.ceil(middle)])/2,results={min:min,max:max,sum:sum,count:count,average:avg,median:med,variance:variance},decimals&&_.forEach(results,function(value,key){results[key]=fixedDecimals(value,decimals)}),results.values=list,results}}),define("taoClientDiagnostic/tools/getConfig",["lodash"],function(_){"use strict";return function(config,defaults){return _(config||{}).omit(function(value){return null==value}).defaults(defaults||{}).value()}}),define(
"taoClientDiagnostic/tools/getLabels",["lodash"],function(_){"use strict";return function(messages,level){return messages=messages||{},_.isArray(messages)||(messages=[messages]),messages[level=Math.min(Math.max(parseInt(level,10)||0,1),messages.length||1)-1]||{}}}),define("taoClientDiagnostic/tools/getStatus",["lodash"],function(_){"use strict";return function(percentage,thresholds,opts){var len,feedback,i,step,options=opts||{},testPercentage=Math.max(0,Math.min(100,Math.round(parseInt(percentage,10)||0))),status={percentage:testPercentage,globalPercentage:options.minimumGlobalPercentage?Math.max(testPercentage,options.minimumGlobalPercentage
):testPercentage,quality:{}};if(thresholds){for(_.isArray(thresholds)||(thresholds=[thresholds]),len=thresholds.length,i=0;i<len&&((step=thresholds[i])&&(!step.threshold||status.percentage>=step.threshold));i++)feedback=step;feedback&&(status.feedback=_.clone(feedback))}return status}}),define("taoClientDiagnostic/tools/performances/tester",["jquery","lodash","i18n","async","context","helpers","taoClientDiagnostic/tools/stats","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getStatus"],function($,_,__,async,context,helpers
,stats,Loader,Renderer,getConfig,getLabels,getStatus){"use strict";var _second=1e3,_defaultTimeout=30*_second,_defaultSamples=["taoClientDiagnostic/tools/performances/data/sample1/","taoClientDiagnostic/tools/performances/data/sample2/","taoClientDiagnostic/tools/performances/data/sample3/"],_defaults={id:"performances",optimal:.025,threshold:.25},_thresholds=[{threshold:0,message:__("Very slow performances"),type:"error"},{threshold:33,message:__("Average performances"),type:"warning"},{threshold:66,message:__("Good performances"),type:"success"}],_messages=[{title:__("Workstation performances"),status:__("Checking the performances..."),performancesMin:__(
"Minimum rendering time"),performancesMax:__("Maximum rendering time"),performancesAverage:__("Average rendering time")}];function loadItem(data,done){var qtiJsonFile=data.url+"qti.json",extension=data.url.split("/")[0],fullpath=require.s.contexts._.config.paths[extension],baseUrl=data.url.replace(extension,fullpath),loader=new Loader,renderer=new Renderer({baseUrl:baseUrl});renderer.getAssetManager&&renderer.getAssetManager().setData("baseUrl",baseUrl),require(["json!"+qtiJsonFile],function(itemData){loader.loadItemData(itemData,function(item){renderer.load(function(){var $container,duration,start,result;start=window.performance.now(),item.setRenderer(this)
,($container=$("<div>").appendTo("body")).append(item.render()),item.postRender(),$container.remove(),duration=(window.performance.now()-start)/_second,result={id:data.id,url:data.url,duration:duration},done(null,result)},this.getLoadedClasses())})})}return function(config){var initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level),idx=0,_samples=_.map(!_.isEmpty(initConfig.samples)&&initConfig.samples||_defaultSamples,function(sample){return{id:"sample"+ ++idx,url:sample,timeout:1e3*initConfig.timeout||_defaultTimeout,nb:initConfig.occurrences||10}});return _samples[0].nb++,{start:function(done){var tests=[],self=this;_.forEach(
_samples,function(data){for(var cb=_.partial(loadItem,data),iterations=data.nb||1;iterations--;)tests.push(cb)}),async.series(tests,function(err,measures){var results,status,summary;if(err&&!measures.length)throw err;measures.shift(),results=stats(measures,"duration",2),status=self.getFeedback(results.average),summary=self.getSummary(results),done(status,summary,results)})},get labels(){return labels},getSummary:function(results){return{performancesMin:{message:labels.performancesMin,value:results.min+" s"},performancesMax:{message:labels.performancesMax,value:results.max+" s"},performancesAverage:{message:labels.performancesAverage,
value:results.average+" s"}}},getFeedback:function(result){var optimal=initConfig.optimal,range=Math.abs(optimal-initConfig.threshold),status=getStatus((range+optimal-result)/range*100,_thresholds);return status.title=labels.title,status.id=initConfig.id,status}}}}),define("taoClientDiagnostic/tools/bandwidth/tester",["lodash","i18n","async","context","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/stats","taoClientDiagnostic/tools/fixedDecimals","taoClientDiagnostic/tools/getStatus"],function(_,__,async,context,getConfig,getLabels,stats,fixedDecimals,getStatus){"use strict";var _mega=1048576,_second=1e3
,_thresholds=[{threshold:0,message:__("Low bandwidth"),type:"error"},{threshold:33,message:__("Average bandwidth"),type:"warning"},{threshold:66,message:__("Good bandwidth"),type:"success"}],_defaults={id:"bandwidth",unit:.16,ideal:45,max:100,minimumGlobalPercentage:!1,feedbackThresholds:_thresholds,fallbackThreshold:.2},_downloadData={"10KB":{id:"10KB",file:"data/bin10KB.data",size:10240,timeout:_second,threshold:0,nb:10},"100KB":{id:"100KB",file:"data/bin100KB.data",size:102400,timeout:2*_second,threshold:0,nb:5},"1MB":{id:"1MB",file:"data/bin1MB.data",size:_mega,timeout:20*_second,threshold:0,nb:3}},_messages=[{title:__("Bandwidth"),status:__(
"Checking the bandwidth..."),legend:__("Number of simultaneous test takers the connection can handle"),bandwidthMin:__("Minimum bandwidth"),bandwidthMax:__("Maximum bandwidth"),bandwidthAverage:__("Average bandwidth")},{title:__("Media intensive bandwidth"),status:__("Checking the media intensive bandwidth..."),legend:__("Number of simultaneous test takers the connection can handle with media intensive"),bandwidthMin:__("Minimum intensive bandwidth"),bandwidthMax:__("Maximum intensive bandwidth"),bandwidthAverage:__("Average intensive bandwidth")}];function download(data,cb){var start,end,timeoutId,url,request,self=this;if(
data.threshold&&this.bandwidth<data.threshold)return cb("threshold");url=context.root_url+"taoClientDiagnostic/views/js/tools/bandwidth/"+data.file+"?"+Date.now(),(request=new XMLHttpRequest).open("GET",url,!0),request.setRequestHeader("Accept","application/octet-stream"),request.onload=function(){var duration,speed;return end=window.performance.now(),clearTimeout(timeoutId),duration=end-start,speed=8*data.size/(duration/_second)/_mega,self.bandwidth=Math.max(self.bandwidth,speed),cb(null,{id:data.id,file:data.file,size:data.size,duration:duration,speed:speed})},request.onerror=function(err){clearTimeout(timeoutId),cb(err)},
request.onreadystatechange=function(){4===request.readyState&&200!==request.status&&(clearTimeout(timeoutId),cb(request.status))},timeoutId=_.delay(cb,data.timeout,"timeout"),start=window.performance.now(),request.send()}return function(config){var initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);return _.isArray(initConfig.feedbackThresholds)&&!initConfig.feedbackThresholds.length&&(initConfig.feedbackThresholds=_thresholds),{start:function(done){var self=this,tests=[];_.forEach(_downloadData,function(data){for(var cb=_.bind(download,self,data),iterations=data.nb||1;iterations--;)tests.push(cb)}),this.bandwidth=0,
async.series(tests,function(err,measures){var results,summary,status,duration=0,size=0;if(err&&!measures.length)throw err;(results=stats(measures,function(value){var speed=0;return value&&(duration+=value.duration,size+=value.size,speed=value.speed,value.speed=fixedDecimals(speed,2)),speed},2)).duration=fixedDecimals(duration/_second,2),results.size=size,summary=self.getSummary(results),status=self.getFeedback(results),done(status,summary,results)})},get labels(){return labels},getSummary:function(results){return{bandwidthMin:{message:labels.bandwidthMin,value:results.min+" Mbps"},bandwidthMax:{message:labels.bandwidthMax,value:results.max+" Mbps"},
bandwidthAverage:{message:labels.bandwidthAverage,value:results.average+" Mbps"}}},getFeedback:function(result){var status,nb,avgResult=result.average,bandwidthUnit=initConfig.unit,threshold=initConfig.ideal,maxTestTakers=initConfig.max,max=threshold*bandwidthUnit,getStatusOptions=initConfig.minimumGlobalPercentage?{minimumGlobalPercentage:initConfig.minimumGlobalPercentage}:{},baseBandwidth=avgResult;return result.min/avgResult>initConfig.fallbackThreshold&&(baseBandwidth=result.min),status=getStatus(baseBandwidth/max*100,initConfig.feedbackThresholds,getStatusOptions),maxTestTakers<(nb=Math.floor(baseBandwidth/bandwidthUnit))&&(nb=">"+maxTestTakers),
status.id=initConfig.id,status.title=labels.title,status.feedback.legend=labels.legend,2<(status.quality.label=nb).toString().length&&(status.quality.wide=!0),status}}}}),define("taoClientDiagnostic/tools/upload/tester",["jquery","lodash","i18n","async","util/url","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getStatus"],function($,_,__,async,urlHelper,getConfig,getLabels,getStatus){"use strict";var data=[],_defaults={id:"upload",size:1048576,optimal:1048576},_thresholds=[{threshold:0,message:__("Low upload speed"),type:"error"},{threshold:33,message:__("Average upload speed"),type:"warning"},{
threshold:66,message:__("Good upload speed"),type:"success"}],_messages=[{title:__("Upload speed"),status:__("Checking upload speed..."),uploadAvg:__("Average upload speed"),uploadMax:__("Max upload speed")}],upload=function(size){var url=urlHelper.route("upload","CompatibilityChecker","taoClientDiagnostic",{cache:Date.now()}),str=function(length){var i,text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}(size);return data=[],$.ajax({url:url,type:"POST",data:{upload:str},xhr:function(){var xhr=new window.XMLHttpRequest,
startTime=Date.now();return xhr.upload.addEventListener("progress",function(evt){var passedTime;evt.lengthComputable&&(passedTime=Date.now()-startTime,data.push({time:passedTime,loaded:evt.loaded,speed:8*evt.loaded/1048576/(passedTime/1e3)}))},!1),xhr}})};return function(config){var initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);return{start:function(done){var self=this;upload(parseInt(initConfig.size,10)).then(function(){var avgSpeed,status,summary,results,totalSpeed=0,maxSpeed=0;_.forEach(data,function(val){totalSpeed+=val.speed,maxSpeed<val.speed&&(maxSpeed=Math.round(100*val.speed)/100)}),avgSpeed=Math.round(
totalSpeed/data.length*100)/100,results={max:maxSpeed,avg:avgSpeed,type:"upload"},status=self.getFeedback(avgSpeed),summary=self.getSummary(results),done(status,summary,results)})},get labels(){return labels},getSummary:function(results){return{uploadAvg:{message:labels.uploadAvg,value:results.avg+" Mbps"},uploadMax:{message:labels.uploadMax,value:results.max+" Mbps"}}},getFeedback:function(result){var optimal=initConfig.optimal/1048576,status=getStatus(100/optimal*result,_thresholds);return status.id=initConfig.id,status.title=labels.title,status}}}}),define("taoClientDiagnostic/tools/getPlatformInfo",["jquery","util/url","core/promise",
"taoClientDiagnostic/tools/getConfig"],function($,url,Promise,getConfig){"use strict";var defaultConfig={browserVersionAction:"whichBrowser",browserVersionController:"CompatibilityChecker",browserVersionExtension:"taoClientDiagnostic"};return function(win,config){var testerUrl;return config=getConfig(config,defaultConfig),testerUrl=function(win,action,controller,extension){var document=win.document,navigator=win.navigator,screen=win.screen,params={},e=0,f=0;return params.ua=navigator.userAgent,e|=win.ActiveXObject?1:0,e|=win.opera?2:0,e|=win.chrome?4:0,e|="getBoxObjectFor"in document||"mozInnerScreenX"in win?8:0,
e|="WebKitCSSMatrix"in win||"WebKitPoint"in win||"webkitStorageInfo"in win||"webkitURL"in win?16:0,e|=16&e&&-1==={}.toString.toString().indexOf("\n")?32:0,params.e=e,f|="sandbox"in document.createElement("iframe")?1:0,f|="WebSocket"in win?2:0,f|=win.Worker?4:0,f|=win.applicationCache?8:0,f|=win.history&&win.history.pushState?16:0,f|=document.documentElement.webkitRequestFullScreen?32:0,f|="FileReader"in win?64:0,params.f=f,params.r=Math.random().toString(36).substring(7),params.w=screen.width,params.h=screen.height,url.route(action,controller,extension,params)}(win,config.browserVersionAction,config.browserVersionController,config.browserVersionExtension),
new Promise(function(resolve,reject){$.ajax({url:testerUrl}).done(resolve).fail(reject)})}}),define("taoClientDiagnostic/tools/browser/tester",["jquery","i18n","util/url","taoClientDiagnostic/tools/getConfig","taoClientDiagnostic/tools/getLabels","taoClientDiagnostic/tools/getPlatformInfo","taoClientDiagnostic/tools/getStatus"],function($,__,url,getConfig,getLabels,getPlatformInfo,getStatus){"use strict";var _defaults={id:"browser",browserVersionAction:"whichBrowser",browserVersionController:"CompatibilityChecker",browserVersionExtension:"taoClientDiagnostic",action:"check",controller:"DiagnosticChecker"},_placeHolders_CURRENT_BROWSER="%CURRENT_BROWSER%",
_placeHolders_CURRENT_OS="%CURRENT_OS%",_messages=[{title:__("Operating system and web browser"),status:__("Checking the browser..."),browser:__("Web browser"),os:__("Operating system")}];return function(config){var initConfig=getConfig(config,_defaults),labels=getLabels(_messages,initConfig.level);return{start:function(done){var self=this;getPlatformInfo(window,initConfig).then(function(results){$.post(url.route(initConfig.action,initConfig.controller,initConfig.extension),results,function(data){var percentage="success"===data.type?100:"warning"===data.type?33:0,status=self.getFeedback(percentage,data),summary=self.getSummary(results)
;status.customMsgRenderer=function(customMsg){return(customMsg||"").replace(_placeHolders_CURRENT_BROWSER,summary.browser.value).replace(_placeHolders_CURRENT_OS,summary.os.value)},done(status,summary,results)},"json")})},get labels(){return labels},getSummary:function(results){var currentBrowser=results.browser+" "+results.browserVersion,currentOs=results.os+" "+results.osVersion;return{browser:{message:labels.browser,value:currentBrowser},os:{message:labels.os,value:currentOs}}},getFeedback:function(result,data){var status=getStatus(result,data);return status.id=initConfig.id,status.title=labels.title,status}}}}),define(
"tpl!taoClientDiagnostic/tools/diagnostic/tpl/main",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program8(depth0,data){var helper,options,buffer="";return buffer+='\n        <p>\n            <label for="school_number">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School number:",options):helperMissing.call(
depth0,"__","School number:",options)))+'</label>\n            <input type="text" data-control="school_number" id="school_number" name="school_number" maxlength="10" placeholder="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School number",options):helperMissing.call(depth0,"__","School number",options)))+'" />\n        </p>\n        <p>\n            <label for="school_pin">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School PIN:",options):helperMissing.call(depth0,"__","School PIN:",options))
)+'</label>\n            <input type="text" data-control="school_pin" id="school_pin" name="school_pin" maxlength="4" placeholder="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School PIN code (4 digits)",options):helperMissing.call(depth0,"__","School PIN code (4 digits)",options)))+'" />\n        </p>\n            '}function program10(depth0,data){var helper,options,buffer="";return buffer+='\n        <p>\n            <label for="school_name">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School name:",options):helperMissing.call(depth0,
"__","School name:",options)))+'</label>\n            <input type="text" data-control="school_name" id="school_name" name="school_name" maxlength="255" placeholder="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"School name",options):helperMissing.call(depth0,"__","School name",options)))+'" />\n        </p>\n            '}return buffer+='<div class="diagnostics-main-area">\n\n    <h1>',stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'</h1>\n\n    <div class="intro">\n        ',!(stack1=helpers.if.call(depth0,depth0&&depth0.header,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",stack1=(helper=helpers.header)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.header)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</p>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n        ",!(stack1=helpers.if.call(depth0,depth0&&depth0.info,{hash:{},inverse:self.noop,fn:self.program(3,function(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",
stack1=(helper=helpers.info)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.info)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</p>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n        ",!(stack1=helpers.if.call(depth0,depth0&&depth0.setup,{hash:{},inverse:self.noop,fn:self.program(5,function(depth0,data){var stack1,helper,buffer="";return buffer+="<p>",stack1=(helper=helpers.setup)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.setup)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</p>"},data),
data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n        ",!(stack1=helpers.if.call(depth0,depth0&&depth0.requireSchoolName,{hash:{},inverse:self.noop,fn:self.program(7,function(depth0,data){var stack1,buffer="";return buffer+="\n            ",!(stack1=helpers.if.call(depth0,depth0&&depth0.validateSchoolName,{hash:{},inverse:self.program(10,program10,data),fn:self.program(8,program8,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n        "},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n    </div>\n\n    <div class="clearfix">\n        <button data-action="test-launcher" class="btn-info small rgt">',stack1=(helper=helpers.button
)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.button)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</button>\n    </div>\n\n    <ul class="plain results"></ul>\n\n    <div class="status">\n        <h2></h2>\n    </div>\n\n</div>'})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/result",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression
;return buffer+='<li data-result="',stack1=(helper=helpers.id)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.id)?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">\n    <h2>',stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.title)?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</h2>\n    <div class="result"></div>\n\n    ',!(stack1=helpers.if.call(depth0,depth0&&depth0.details,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var helper,options,buffer=""
;return buffer+='\n    <div class="clearfix">\n        <button data-action="show-details" class="rgt btn-info small">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Show Details",options):helperMissing.call(depth0,"__","Show Details",options)))+'</button>\n        <button data-action="hide-details" class="rgt btn-info small hidden">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Hide Details",options):helperMissing.call(depth0,"__","Hide Details",options)))+'</button>\n        <div class="details hidden"></div>\n    </div>\n    '},data),
data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n</li>"})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/details",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="details">\n    <h2>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Details",options):helperMissing.call(depth0,"__","Details",
options)))+'</h2>\n    <div>\n        <table class="matrix">\n            <tbody>\n            ',!(stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="\n                <tr><td>",stack1=(helper=helpers.message)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.message)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</td><td>",stack1=(helper=helpers.value)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.value)===functionType?helper.call(depth0,{hash:{},data:data}):helper,
buffer+=escapeExpression(stack1)+"</td></tr>\n            "},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n            </tbody>\n        </table>\n    </div>\n</div>"})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/feedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="small feedback feedback-',stack1=(helper=helpers.type)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.type)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">\n    <span class="icon icon-',stack1=(helper=helpers.type)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.type)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"></span>\n    <span class="msg">',stack1=(helper=helpers.message)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.message)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>\n    ",!(stack1=helpers.if.call(depth0,depth0&&depth0.legend
,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="legend">',stack1=(helper=helpers.legend)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.legend)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</div>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n    ",!(stack1=helpers.if.call(depth0,depth0&&depth0.customMsg,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="customMsg">',stack1=(helper=helpers.customMsg)?helper.call(depth0,{
hash:{},data:data}):typeof(helper=depth0&&depth0.customMsg)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</div>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n</div>"})}),define("tpl!taoClientDiagnostic/tools/diagnostic/tpl/quality-bar",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="quality-bar">\n    <div class="quality-indicator',!(
stack1=helpers.if.call(depth0,depth0&&depth0.wide,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){return" wide"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='"',!(stack1=helpers.if.call(depth0,depth0&&depth0.label,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,helper,buffer="";return buffer+=' title="',stack1=(helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"'},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="></div>\n</div>"})}),define(
"css!taoClientDiagnosticCss/diagnostics",[],function(){}),define("taoClientDiagnostic/tools/diagnostic/diagnostic",["jquery","lodash","i18n","async","ui/feedback","ui/component","core/logger","core/store","core/promise","core/dataProvider/request","ui/dialog/alert","util/url","taoClientDiagnostic/tools/performances/tester","taoClientDiagnostic/tools/bandwidth/tester","taoClientDiagnostic/tools/upload/tester","taoClientDiagnostic/tools/browser/tester","taoClientDiagnostic/tools/getStatus","taoClientDiagnostic/tools/getConfig","tpl!taoClientDiagnostic/tools/diagnostic/tpl/main","tpl!taoClientDiagnostic/tools/diagnostic/tpl/result",
"tpl!taoClientDiagnostic/tools/diagnostic/tpl/details","tpl!taoClientDiagnostic/tools/diagnostic/tpl/feedback","tpl!taoClientDiagnostic/tools/diagnostic/tpl/quality-bar","css!taoClientDiagnosticCss/diagnostics"],function($,_,__,async,feedback,component,loggerFactory,store,Promise,request,dialogAlert,urlUtil,performancesTester,bandwidthTester,uploadTester,browserTester,getStatus,getConfig,mainTpl,resultTpl,detailsTpl,feedbackTpl,qualityBarTpl){"use strict";var logger=loggerFactory("taoClientDiagnostic/diagnostic"),_defaults={title:__("System Compatibility"),header:__(
"This tool will run a number of tests in order to establish how well your current environment is suitable to run the TAO platform."),info:__("Be aware that these tests will take up to several minutes."),button:__("Test system compatibility"),actionStore:"storeData",actionSchool:"schoolName",controller:"DiagnosticChecker",extension:"taoClientDiagnostic",actionDropId:"deleteId",storeAllRuns:!1,configurableText:{}},_thresholds=[{threshold:0,message:__("Your system requires a compatibility update, please contact your system administrator."),type:"error"},{threshold:33,message:__("Your system is not optimal, please contact your system administrator."),
type:"warning"},{threshold:66,message:__("Your system is fully compliant."),type:"success"}],diagnostic={changeStatus:function(status){return this.is("rendered")&&this.controls.$status.html(status),this},store:function(type,details,done){var config=this.config;(details=_.omit(details,"values")).type=type,$.post(urlUtil.route(config.actionStore,config.controller,config.extension,config.storeParams),details,done,"json")},getCustomMsg:function(key){return this.config.configurableText[key]},addCustomFeedbackMsg:function(status,msg){this.hasFailed(status)&&msg&&(_.isFunction(status.customMsgRenderer)&&(msg=status.customMsgRenderer(msg)),
status.feedback=status.feedback||{},status.feedback.customMsg=msg)},hasFailed:function(result){return!(result&&result.feedback&&"success"===result.feedback.type)},addResult:function(result){var $main,$indicator,$result;return this.is("rendered")&&(result.quality&&result.quality.label&&2<result.quality.label.toString().length&&(result.quality.wide=!0),$result=($main=$(resultTpl(result))).find(".result"),result.feedback&&$result.append($(feedbackTpl(result.feedback))),result.quality&&$result.append($(qualityBarTpl(result.quality))),result.details&&$main.find(".details").append($(detailsTpl(result.details))),$indicator=$main.find(".quality-indicator"),
this.controls.$results.append($main),$main.fadeIn(function(){$indicator.length&&$indicator.animate({left:result.percentage*$main.outerWidth()/100-$indicator.outerWidth()/2})})),this},cleanUp:function(){return this.controls.$results.empty(),this},enable:function(){return this.controls.$start.removeClass("hidden"),this},disable:function(){return this.controls.$start.addClass("hidden"),this},prepare:function(){return this.trigger("start"),this.changeStatus(__("Starting...")),this.setState("running",!0),this.setState("done",!1),this.cleanUp(),this.disable(),this},finish:function(){var config=this.config;return this.enable(),
config.storeAllRuns&&this.deleteIdentifier(),this.trigger("end"),this.changeStatus(__("Done!")),this.setState("running",!1),this.setState("done",!0),this},deleteIdentifier:function(){var url=urlUtil.route(this.config.actionDropId,this.config.controller,this.config.extension);return request(url,null,"POST")},run:function(){function doRun(){self.is("rendered")&&(self.prepare(),_.forEach(self.config.testers,function(testerConfig,testerId){testerConfig.id=testerConfig.id||testerId,testerConfig.enabled&&testers.push(function(cb){!function(testerConfig,cb){var testerId=testerConfig.id;self.trigger("starttester",testerId),self.setState(testerId,!0),require([
testerConfig.tester],function(testerFactory){var tester=testerFactory(getConfig(testerConfig,self.config),self);self.changeStatus(tester.labels.status),tester.start(function(status,details,results){var customMsg;testerConfig.customMsgKey&&(customMsg=self.getCustomMsg(testerConfig.customMsgKey),self.addCustomFeedbackMsg(status,customMsg)),_.forEach(details,function(info){information.push(info)}),scores[status.id]=status,self.trigger("endtester",testerId,status),self.setState(testerId,!1),results=_.mapValues(results,function(value){switch(typeof value){case"boolean":return value?1:0;case"object":return JSON.stringify(value)}return value}),self.store(testerId,
results,function(){self.addResult(status),cb()})})})}(testerConfig,cb)})}),async.series(testers,function(){var total=_.min(scores,"globalPercentage"),status=getStatus(total.globalPercentage,_thresholds);status.title=__("Total"),status.id="total",self.addCustomFeedbackMsg(status,self.config.configurableText.diagTotalCheckResult),status.details=information,self.addResult(status),self.finish()}))}var self=this,information=[],scores={},testers=[],customInput=self.getCustomInput();return 0<_.size(customInput)?self.store("custom_input",customInput,doRun):doRun(),self},getCustomInput:function(){var vars={},self=this;return window.location.href.replace(location.hash
,"").replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(m,key,value){_.has(self.config.customInput,key)&&(vars[key]=void 0!==value?value:"")}),vars}};return function(container,config){var diagComponent;return config&&_.forEach(["title","header","footer","info","button"],function(name){config[name]&&(config[name]=__(config[name]))}),diagComponent=component(diagnostic,_defaults).setTemplate(mainTpl).on("destroy",function(){this.controls=null}).on("init",function(){this.render(container)}).on("render",function(){var self=this,launch=function(){runDiagnostics()};function runDiagnostics(data){data&&_.isPlainObject(data)&&(self.config.storeParams=_.assign(
self.config.storeParams||{},data)),self.run()}function getControl(name){return self.controls["$"+name]}function getInputValue(name){var $control=getControl(name);return($control&&$control.val()||"").trim()}function toggleControl(name,state){var $control=getControl(name);$control&&(void 0===state&&(state=!$control.is(":enabled")),state?$control.removeProp("disabled"):$control.prop("disabled",!0))}function manageSchoolName(fields,validate){function toggleStart(){var allow=_.every(fields,getInputValue);return toggleControl("start",allow),allow}function toggleFields(state){_.forEach(fields,function(fieldName){toggleControl(fieldName,state)})}_.forEach(fields,
function(fieldName){self.controls["$"+fieldName]=self.getElement().find('[data-control="'+fieldName+'"]').on("keypress",function(e){var shouldStart=13===e.which;shouldStart&&e.preventDefault(),_.defer(function(){toggleStart()&&shouldStart&&self.controls.$start.click()})})}),toggleStart(),toggleFields(!1),store("client-diagnostic").then(function(storage){return self.on("start.school",function(){_.forEach(fields,function(fieldName){storage.setItem(fieldName,getInputValue(fieldName)).catch(function(error){logger.error(error)})})}),Promise.all(_.map(fields,function(fieldName){return storage.getItem(fieldName).then(function(value){!function(name,value){
var $control=getControl(name);$control&&$control.val(value)}(fieldName,value)})}))}).catch(function(error){logger.error(error)}).then(function(){toggleFields(!0),toggleStart()}),launch=function(){var values=_.reduce(fields,function(result,fieldName){return result[fieldName]=getInputValue(fieldName),result},{});self.changeStatus(__("Getting school name...")).cleanUp().disable(),_.isFunction(validate)?validate(values).then(runDiagnostics).catch(function(error){var response=error.response||{},message=response.errorMsg||response.errorMessage||__("An error occurred! Please verify your input!");dialogAlert(message),logger.error(error),self.changeStatus(__(
"Failed to get school name")).enable()}):runDiagnostics(values)},self.on("start.school",function(){toggleFields(!1)}).on("end.school",function(){toggleFields(!0)})}this.controls={$start:this.$component.find('[data-action="test-launcher"]'),$status:this.$component.find(".status h2"),$results:this.$component.find(".results")},this.controls.$start.on("click",function(){self.controls.$start.is(":enabled")&&launch()}),this.config.requireSchoolName&&(this.config.validateSchoolName?manageSchoolName(["school_number","school_pin"],function(values){var componentConfig=self.config;return request(urlUtil.route(componentConfig.actionSchool,componentConfig.controller,
componentConfig.extension),values,"POST").then(function(data){return{school_name:data,school_number:values.school_number}})}):manageSchoolName(["school_name"])),this.controls.$results.on("click",'button[data-action="show-details"]',function(){var $btn=$(this).closest("button"),$result=$btn.closest("[data-result]");$result.find(".details").removeClass("hidden"),$btn.addClass("hidden"),$result.find('[data-action="hide-details"]').removeClass("hidden")}),this.controls.$results.on("click",'button[data-action="hide-details"]',function(){var $btn=$(this).closest("button"),$result=$btn.closest("[data-result]");$result.find(".details").addClass("hidden"),
$btn.addClass("hidden"),$result.find('[data-action="show-details"]').removeClass("hidden")})}),_.defer(function(){diagComponent.init(config)}),diagComponent}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}(
'.diagnostics-content-area{max-width:768px;margin:40px auto 40px auto}.diagnostics-main-area{margin:40px auto 0 auto;background:#f3f1ef;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;padding:20px}.diagnostics-main-area h1,.diagnostics-main-area h2,.diagnostics-main-area h3{font-style:normal;font-family:"Source Sans Pro",sans-serif}.diagnostics-main-area h1{margin-bottom:20px;font-size:20px;font-size:2rem}.diagnostics-main-area h2{margin:0;font-size:14px;font-size:1.4rem}.diagnostics-main-area h3{margin-top:10px;margin-bottom:5px;font-size:12px;font-size:1.2rem}.diagnostics-main-area .status h2,.diagnostics-main-area .details h2{margin:1rem 0}.diagnostics-main-area .legend{font-style:italic;font-weight:normal;font-family:"Source Sans Pro",sans-serif;font-size:11px;font-size:1.1rem}.diagnostics-main-area .customMsg{margin-top:10px}.diagnostics-main-area .quality-bar{height:15px;background:linear-gradient(to right, #CE1431 0%, #D57915 25%, #D5A215 50%, #D5CB15 75%, #36B111 100%);opacity:.8;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;margin:5px 0 10px;position:relative}.diagnostics-main-area .quality-indicator{position:absolute;border-width:10px 8px;border-style:solid;border-color:#333 transparent transparent;top:-1px;height:25px;width:0}.diagnostics-main-area .quality-indicator[title]:before{font-size:11px;font-size:1.1rem;content:attr(title);position:absolute;top:-36px;left:-12px;text-align:center;width:24px;height:24px;line-height:24px;display:inline-block;background-color:#0e5d91;color:rgba(255,255,255,0.9);-moz-border-radius:12px;-webkit-border-radius:12px;border-radius:12px}.diagnostics-main-area .quality-indicator.wide[title]:before{left:-16px;width:32px}.diagnostics-main-area [data-result],.diagnostics-main-area .bandwidth-box{display:none}.diagnostics-main-area [data-action=bandwidth-launcher]{margin:5px 0 10px}.diagnostics-main-area li{padding-bottom:10px}.diagnostics-main-area .intro{margin-bottom:20px}.diagnostics-main-area .intro label{display:inline-block;width:150px}table.datatable [class^="icon-"]{padding:0}table.datatable td{font-size:90%;font-weight:normal}table.datatable .progress .state:not(:first-child):before{content:\' - \'}table.datatable .progress .item-time:before{content:\' (\'}table.datatable .progress .item-time .total:before{content:\' / \'}table.datatable .progress .item-time:after{content:\')\'}.details table.matrix{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;margin-top:5px}.details table.matrix td:first-child{min-width:30%}.diagnostic-scope h1{font-family:"Source Sans Pro",sans-serif;font-size:22px;font-size:2.2rem;font-weight:normal}.diagnostic-scope h2{font-family:"Source Sans Pro",sans-serif;font-size:18px;font-size:1.8rem;margin:30px 0 10px}.diagnostic-scope form.daterange label{padding:0}.diagnostic-scope form.daterange input{margin:0 10px}.diagnostic-scope table.datatable [class^="icon-"]{padding:0}.diagnostic-scope table.datatable td{font-size:90%;font-weight:normal}.diagnostic-scope .content{margin:auto}.diagnostic-scope .diagnostic-index .content,.diagnostic-scope .diagnostic-runner .content{width:100%}.diagnostic-scope .diagnostic-index .message,.diagnostic-scope .diagnostic-runner .message{padding:8px;text-align:center}.diagnostic-scope .panel .action-bar{background:#266d9c;padding:3px;overflow:hidden;color:#e7eff4}.diagnostic-scope .panel .action-bar .btn-info{overflow:hidden;background:transparent;border:1px rgba(255,255,255,0.3) solid}.diagnostic-scope .diagnostics-main-area{margin-top:0px;max-width:800px}.diagnostic-scope .detailed-value{display:flex;justify-content:space-between}.diagnostic-scope .detailed-value.errors{color:#d8ae5b}.diagnostic-scope .detailed-value .details{font-size:2rem;cursor:pointer;color:#3e7da7}.diagnostic-scope .detailed-value .details:hover{color:#03131d}.action-bar .tool-exitButton,.action-bar [data-control="exitButton"]{float:right}\n\n/*# sourceMappingURL=diagnostics.css.map */'
),define("taoClientDiagnostic/loader/diagnostic.bundle",function(){}),window.bundles=(window.bundles||[]).concat(["taoQtiItem/loader/taoQtiItem.min","taoItems/loader/taoItems.min"]);
//# sourceMappingURL=diagnostic.min.js.map